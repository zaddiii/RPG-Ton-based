




<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RPG Battle Arena ‚Äî Dark Vibes</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
/* === Reset & Body === */
* { margin:0; padding:0; box-sizing:border-box; }

html, body {
  height: 100%;
  width: 100%;
  overflow-x: hidden;
  font-family: 'Share Tech Mono', monospace;
  color: #fff;
  background: url('https://raw.githubusercontent.com/zaddiii/RPG-Battle-Arena/71c5d6084edf814937ae42963d74c3c3319358b7/James%20Paick%20-%20Jamespaickart%20-%202017-09-20_15-00-51_Utc.jpeg') 
    no-repeat center center fixed;
  background-size: cover;
  background-attachment: fixed;
}

/* Overlay for dark vibe */
body::before {
  content: '';
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.65);
  z-index: -1;
}

/* Title */
h1 {
  text-align: center;
  font-size: clamp(1.8rem, 4vw, 2.5rem);
  color: #0ff;
  text-shadow: 0 0 10px #0ff, 0 0 20px #00f;
  margin: 2vh 0;
}

/* Scoreboard (transparent) */
#scoreboard {
  position: fixed;
  top: 1.5vh;
  left: 1.5vw;
  background: rgba(0,0,0,0.25);
  padding: 1vh 1.5vw;
  border-radius: 12px;
  font-size: clamp(11px, 1.6vw, 14px);
  line-height: 1.4;
  text-align: left;
  box-shadow: 0 0 10px #0ff;
  z-index: 10;
}

/* Game Area */
#gameArea {
  width: min(90vw, 650px);
  margin: 10vh auto 4vh auto;
  padding: 2vw;
  background: rgba(0,0,30,0.9);
  border-radius: 20px;
  box-shadow: 0 0 20px #0ff inset;
}

/* Bars */
.bar-container {
  position: relative;
  background: #111;
  border-radius: 12px;
  height: clamp(18px, 2.5vh, 22px);
  margin-bottom: 12px;
  overflow: hidden;
  border: 2px solid #222;
}
.bar {
  height: 100%;
  transition: width 0.5s ease, background 0.5s ease;
}
#playerHealthBar { background: linear-gradient(90deg, #f00, #900); }
#playerManaBar { background: linear-gradient(90deg, #00f, #006); }
#enemyHealthBar { background: linear-gradient(90deg, #f00, #900); }
#enemyManaBar { background: linear-gradient(90deg, #00f, #006); }
#enemyIntelligenceBar { background: linear-gradient(90deg, #0f0, #060); }

.bar-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: #fff;
  font-size: clamp(11px, 1.6vw, 13px);
  font-weight: bold;
  text-shadow: 0 0 5px #000;
  pointer-events: none;
}

/* Buttons */
button {
  padding: clamp(10px, 1.5vh, 14px) clamp(18px, 2vw, 26px);
  margin: 6px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(to bottom, #0ff, #008888);
  color: #000;
  font-weight: bold;
  font-size: clamp(12px, 2vw, 16px);
  cursor: pointer;
  box-shadow: 0 0 15px #0ff;
  transition: 0.15s;
}
button:hover {
  background: linear-gradient(to bottom, #00d4ff, #0ff);
  transform: scale(1.08);
  box-shadow: 0 0 25px #0ff, 0 0 35px #00ffff;
}
button:active {
  transform: scale(0.97);
  box-shadow: 0 0 10px #0ff;
}

/* Battle Log */
#battleLog {
  background: rgba(0,0,0,0.7);
  padding: 12px;
  border-radius: 12px;
  height: clamp(120px, 18vh, 160px);
  overflow-y: auto;
  font-size: clamp(11px, 1.6vw, 13px);
  margin-top: 15px;
  text-align: left;
}
#battleLog p {
  margin-bottom: 6px;
  opacity: 0;
  animation: fadeIn 0.4s forwards;
}
@keyframes fadeIn {
  to { opacity:1; }
}

/* Navigation Menu */
#navMenu {
  position: fixed;
  bottom: 2vh;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
  z-index: 10;
}
#navMenu button {
  font-size: clamp(11px, 2vw, 13px);
  padding: 10px 18px;
  border-radius: 50px;
}

/* Alert Box */
#alertBox {
  position: fixed;
  top: 6vh;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 20px;
  background: rgba(0,0,0,0.8);
  border: 2px solid #0ff;
  border-radius: 10px;
  font-weight: bold;
  color: #0ff;
  opacity: 0;
  transition: opacity 0.3s ease;
  font-size: clamp(12px, 1.8vw, 14px);
}
#alertBox.show { opacity: 1; }

/* Responsive Scaling */
@media (max-width: 600px) {
  h1 { font-size: clamp(1.5rem, 5vw, 2.2rem); }
  #gameArea { margin: 8vh auto; padding: 4vw; }
  button { font-size: clamp(11px, 3vw, 14px); }
  #battleLog { height: 130px; }
}
</style>
</head>
<body>

<h1>RPG Battle Arena ‚öî</h1>

<div id="scoreboard">
  <p><strong>Player Wins:</strong> <span id="playerWins">0</span></p>
  <p><strong>Enemy Wins:</strong> <span id="enemyWins">0</span></p>
  <p><strong>Score:</strong> <span id="score">0</span></p>
  <p><strong>AI IQ:</strong> <span id="aiIQ">0</span></p>
  <p><strong>üí∞ Tokens:</strong> <span id="walletBalance">0</span></p>
</div>

<div id="gameArea">
  <p><strong>üßë‚ÄçüéÆ Player</strong></p>
  <div class="bar-container"><div id="playerHealthBar" class="bar" style="width:100%;"></div><span id="playerHealthText" class="bar-text">200 / 200</span></div>
  <div class="bar-container"><div id="playerManaBar" class="bar" style="width:100%;"></div><span id="playerManaText" class="bar-text">50 / 50</span></div>

  <p style="margin-top:12px;"><strong>üëæ Enemy</strong></p>
  <div class="bar-container"><div id="enemyHealthBar" class="bar" style="width:100%;"></div><span id="enemyHealthText" class="bar-text">200 / 200</span></div>
  <div class="bar-container"><div id="enemyManaBar" class="bar" style="width:100%;"></div><span id="enemyManaText" class="bar-text">50 / 50</span></div>
  <div class="bar-container"><div id="enemyIntelligenceBar" class="bar" style="width:0;"></div><span id="enemyIntelligenceText" class="bar-text">IQ 0</span></div>

  <div style="margin-top:15px;">
    <button onclick="playerAction('Attack')">Attack</button>
    <button onclick="playerAction('Defend')">Defend</button>
    <button onclick="playerAction('Special')">Special (-30 MP)</button>
    <button onclick="playerAction('Heal')">Heal (+20 HP, -20 MP)</button>
    <button onclick="resetGame()">Reset</button>
  </div>

  <div id="battleLog"></div>
</div>

<div id="alertBox"></div>

<div id="navMenu">
  <button onclick="location.href='upgrade.html'">üõ† Upgrade</button>
  <button onclick="window.open('rpgFlip.html','_blank','width=500,height=700')">üé≤ Flip Coin</button>
</div>

<script>
/* === Unified Backend Setup === */
const PLAYER_ID = "player123";
const BASE_URL = "https://rpg-storage-server.onrender.com/players";

/* === Base Stats === */
const PLAYER_MAX_HP = 200;
const PLAYER_BASE_MP = 50;
const MAX_MP = PLAYER_BASE_MP;
const SPECIAL_COST = 30;
const HEAL_COST = 20;
const HEAL_HP = 20;

/* === Game State === */
let attackUpgrade = 0;
let specialUpgrade = 0;

let gameState = {
  scores: { player: 0, enemy: 0, score: 0 },
  player: { hp: PLAYER_MAX_HP, mp: PLAYER_BASE_MP },
  enemy: { hp: 200, mp: 50, maxHP: 200, maxMP: 50, iq: 0 },
  wallet: { tokens: 1000 },
  upgrades: { attack: attackUpgrade, special: specialUpgrade },
  roundOver: false
};

/* === Load/Save from backend === */
async function loadPlayerData(){
  try{
    const res = await fetch(`${BASE_URL}/${PLAYER_ID}`);
    const data = await res.json();

    gameState.wallet.tokens = data.tokens ?? 1000;
    gameState.player.hp = data.hp ?? PLAYER_MAX_HP;
    gameState.player.mp = data.mp ?? PLAYER_BASE_MP;
    gameState.enemy.hp = data.enemyHp ?? 200;
    gameState.enemy.mp = data.enemyMp ?? 50;
    gameState.enemy.maxHP = data.enemyMaxHP ?? 200;
    gameState.enemy.maxMP = data.enemyMaxMP ?? 50;
    gameState.enemy.iq = data.enemyIQ ?? 0;

    attackUpgrade = data.attackUpgrade ?? 0;
    specialUpgrade = data.specialUpgrade ?? 0;
    applyUpgrades();
    updateScoreboard();
    updateBars();
  } catch(err){ console.error("Error loading player data:", err); }
}

async function savePlayerData(){
  try{
    const payload = {
      tokens: gameState.wallet.tokens,
      hp: gameState.player.hp,
      mp: gameState.player.mp,
      attackUpgrade,
      specialUpgrade,
      enemyHp: gameState.enemy.hp,
      enemyMp: gameState.enemy.mp,
      enemyMaxHP: gameState.enemy.maxHP,
      enemyMaxMP: gameState.enemy.maxMP,
      enemyIQ: gameState.enemy.iq
    };
    await fetch(`${BASE_URL}/${PLAYER_ID}`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
  } catch(err){ console.error("Error saving player data:", err); }
}

/* === Utilities === */
const clamp = (v, lo, hi)=>Math.max(lo,Math.min(hi,v));
const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
const log=t=>{const p=document.createElement("p");p.innerText=t;battleLog.appendChild(p);battleLog.scrollTop=battleLog.scrollHeight;};
function showAlert(msg){const box=document.getElementById("alertBox");box.textContent=msg;box.classList.add("show");setTimeout(()=>box.classList.remove("show"),1500);}
function applyUpgrades(){gameState.upgrades.attack=attackUpgrade;gameState.upgrades.special=specialUpgrade;}

/* === Bars & Scoreboard Updates === */
function updateBars(){
  playerHealthBar.style.width = (gameState.player.hp/PLAYER_MAX_HP*100)+'%';
  playerManaBar.style.width = (gameState.player.mp/MAX_MP*100)+'%';
  enemyHealthBar.style.width = (gameState.enemy.hp/gameState.enemy.maxHP*100)+'%';
  enemyManaBar.style.width = (gameState.enemy.mp/gameState.enemy.maxMP*100)+'%';
  enemyIntelligenceBar.style.width = Math.min(gameState.enemy.iq,100)+'%';
  playerHealthText.innerText = `${gameState.player.hp}/${PLAYER_MAX_HP}`;
  playerManaText.innerText = `${gameState.player.mp}/${MAX_MP}`;
  enemyHealthText.innerText = `${gameState.enemy.hp}/${gameState.enemy.maxHP}`;
  enemyManaText.innerText = `${gameState.enemy.mp}/${gameState.enemy.maxMP}`;
  enemyIntelligenceText.innerText = `IQ ${gameState.enemy.iq.toFixed(1)}`;
}

function updateScoreboard(){
  playerWins.innerText = gameState.scores.player;
  enemyWins.innerText = gameState.scores.enemy;
  score.innerText = gameState.scores.score;
  aiIQ.innerText = gameState.enemy.iq.toFixed(1);
  walletBalance.innerText = gameState.wallet.tokens;
}

/* === Enemy Scaling === */
function increaseEnemyStatsPerWin(){
  gameState.enemy.iq = +(gameState.enemy.iq+1.5).toFixed(1);
  gameState.enemy.maxHP += 100;
  gameState.enemy.maxMP += 20;
  gameState.enemy.hp = gameState.enemy.maxHP;
  gameState.enemy.mp = gameState.enemy.maxMP;
}

/* === Player Actions === */
let aiInterval=null, aiActive=false, regenInterval=null;

function playerAction(act){
  if(gameState.roundOver) return;
  if(!aiActive){ aiActive=true; startAI(); log("AI engages after your first move!"); }
  if(act==='Attack'){
    const dmg=Math.floor(randInt(12,28)*(1+attackUpgrade/100));
    gameState.enemy.hp=clamp(gameState.enemy.hp-dmg,0,gameState.enemy.maxHP);
    showAlert(`You attacked for ${dmg}!`);
    log(`Player attacks ‚Üí ${dmg} dmg.`);
  } else if(act==='Defend'){ showAlert("You defend!"); log("Player defends."); }
  else if(act==='Special'){
    if(gameState.player.mp<SPECIAL_COST){ showAlert('Not enough mana.'); return; }
    gameState.player.mp -= SPECIAL_COST;
    const dmg=Math.floor(randInt(30,50)*Math.pow(2,specialUpgrade||0));
    gameState.enemy.hp=clamp(gameState.enemy.hp-dmg,0,gameState.enemy.maxHP);
    showAlert(`You used Special ‚Üí ${dmg}!`);
    log(`Player Special ‚Üí ${dmg} dmg.`);
  } else if(act==='Heal'){
    if(gameState.player.hp>=PLAYER_MAX_HP){ showAlert('HP full.'); return; }
    if(gameState.player.mp<HEAL_COST){ showAlert('Not enough mana.'); return; }
    const heal=Math.min(HEAL_HP,PLAYER_MAX_HP-gameState.player.hp);
    gameState.player.mp -= HEAL_COST;
    gameState.player.hp = clamp(gameState.player.hp+heal,0,PLAYER_MAX_HP);
    showAlert(`Healed +${heal} HP (-${HEAL_COST} MP).`);
    log(`Player heals +${heal} HP.`);
  }
  updateBars(); checkEnd(); savePlayerData();
}

/* === Enemy AI === */
function decideAction(){const r=Math.random();if(r<0.5)return 'Attack';if(r<0.65)return 'Defend';if(r<0.85)return 'Heal';return 'Special';}
function enemyAction(){
  if(!aiActive||gameState.player.hp<=0||gameState.enemy.hp<=0||gameState.roundOver)return;
  const act=decideAction();
  if(act==='Attack'){let dmg=randInt(18,35);gameState.player.hp=clamp(gameState.player.hp-dmg,0,PLAYER_MAX_HP);showAlert(`Enemy attacks ${dmg}!`);log(`Enemy attacks ‚Üí ${dmg} dmg.`);}
  else if(act==='Special'&&gameState.enemy.mp>=SPECIAL_COST){gameState.enemy.mp-=SPECIAL_COST;let dmg=randInt(30,50);gameState.player.hp=clamp(gameState.player.hp-dmg,0,PLAYER_MAX_HP);showAlert(`Enemy Special ‚Üí ${dmg}!`);log(`Enemy Special ‚Üí ${dmg} dmg.`);}
  else if(act==='Heal'&&gameState.enemy.mp>=HEAL_COST&&gameState.enemy.hp<gameState.enemy.maxHP){const heal=Math.min(HEAL_HP,gameState.enemy.maxHP-gameState.enemy.hp);gameState.enemy.mp-=HEAL_COST;gameState.enemy.hp=clamp(gameState.enemy.hp+heal,0,gameState.enemy.maxHP);showAlert(`Enemy heals +${heal} HP.`);log(`Enemy heals +${heal} HP.`);}
  updateBars(); checkEnd(); savePlayerData();
}

/* === Intervals === */
function startAI(){clearInterval(aiInterval);aiInterval=setInterval(enemyAction,600);}
function startRegen(){
  clearInterval(regenInterval);
  regenInterval = setInterval(()=>{
    gameState.player.mp = clamp(gameState.player.mp + 2, 0, MAX_MP);
    gameState.enemy.mp = clamp(gameState.enemy.mp + 2, 0, gameState.enemy.maxMP);
    updateBars();
  }, 1000);
}

/* === Check End of Round === */
function checkEnd(){
  if(gameState.roundOver) return;
  if(gameState.player.hp <= 0 || gameState.enemy.hp <= 0){
    gameState.roundOver = true;
    clearInterval(aiInterval);
    clearInterval(regenInterval);
    aiActive = false;

    if(gameState.enemy.hp <= 0 && gameState.player.hp <= 0){
      showAlert('Double KO!');
      log('Double KO ‚Äî no changes.');
    } else if(gameState.enemy.hp <= 0){
      showAlert('You Win!');
      gameState.scores.player++;
      gameState.scores.score += 50;
      const reward = 100 + randInt(0,50);
      gameState.wallet.tokens += reward;
      increaseEnemyStatsPerWin();
      log(`üèÜ You earned ${reward} tokens! Wallet: ${gameState.wallet.tokens}`);
    } else {
      showAlert('You Lose!');
      gameState.scores.enemy++;
      gameState.scores.score = Math.max(0, gameState.scores.score - 30);
      log('You lost this round.');
    }
    updateScoreboard();
    savePlayerData();
    setTimeout(()=>{
      gameState.roundOver = false;
      newRound();
    }, 1200);
  }
}

/* === Start New Round === */
function newRound(){
  gameState.player.hp = PLAYER_MAX_HP;
  gameState.player.mp = MAX_MP;
  gameState.enemy.hp = gameState.enemy.maxHP;
  gameState.enemy.mp = gameState.enemy.maxMP;
  aiActive = false;
  updateBars();
  updateScoreboard();
  log('New round ‚Äî AI waits for your move.');
  startRegen();
  savePlayerData();
}

/* === Reset Game === */
function resetGame(){
  gameState.scores = { player:0, enemy:0, score:0 };
  gameState.wallet.tokens = 1000;
  gameState.enemy.iq = 0;
  gameState.enemy.maxHP = 200;
  gameState.enemy.maxMP = 50;
  gameState.enemy.hp = 200;
  gameState.enemy.mp = 50;
  attackUpgrade = 0;
  specialUpgrade = 0;
  applyUpgrades();
  savePlayerData();
  newRound();
  updateScoreboard();
  log('Game reset ‚Äî Wallet restored and enemy stats reset.');
}

/* === On Page Load === */
window.addEventListener("DOMContentLoaded", () => {
  loadPlayerData();
  updateBars();
  updateScoreboard();
  startRegen();
});
</script>

</body>
</html>
