



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RPG Game Solana v1</title>
  <style>
    body {
      background-color: burlywood;
      font-family: "Times New Roman", serif;
      color: black;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    button {
      border: none;
      border-radius: 15px;
      padding: 8px 15px;
      margin: 5px;
      background-color: white;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    #gameArea { margin-top: 20px; display: none; }
  </style>
</head>
<body>

  <h1>RPG Game (Solana)</h1>
  <p>Wallet Address: <span id="walletAddress">not connected</span></p>
  <button id="connectWalletBtn">Connect Phantom Wallet</button>

  <div id="gameArea">
    <p>Player Health: <span id="playerHealth">100</span></p>
    <p>Player Mana: <span id="playerMana">30</span></p>
    <p>Enemy Health: <span id="enemyHealth">100</span></p>
    <p>Enemy Mana: <span id="enemyMana">30</span></p>

    <button onclick="playerAction('Attack')">Attack</button>
    <button onclick="playerAction('Defend')">Defend</button>
    <button onclick="playerAction('Special')">Special (-20 MP)</button>
    <button onclick="playerAction('Heal')">Heal (+30 HP, -10 MP)</button>
    <button onclick="resetGame(true)">Reset Game</button>
  </div>

  <h2>Scoreboard</h2>
  <p>Player Wins: <span id="playerWins">0</span></p>
  <p>Enemy Wins: <span id="enemyWins">0</span></p>

  <button id="startGameBtn">Start Game</button>

  <script>
    // ===== Wrap everything after DOM loads =====
    window.addEventListener('load', async () => {

      // ----- Solana Wallet -----
      let walletAddress = null;
      const walletSpan = document.getElementById('walletAddress');
      const connectBtn = document.getElementById('connectWalletBtn');

      async function connectWallet() {
        try {
          if (window.solana && window.solana.isPhantom) {
            const resp = await window.solana.connect();
            walletAddress = resp.publicKey.toString();
            walletSpan.innerText = walletAddress;
            connectBtn.style.display = 'none';
          } else {
            alert("Phantom wallet not detected. Please install Phantom.");
          }
        } catch(e) {
          console.error(e);
        }
      }

      connectBtn.addEventListener('click', connectWallet);

      // ----- RPG Game Variables -----
      let playerHealth, enemyHealth, playerMana, enemyMana;
      let playerDefending = false, enemyDefending = false;
      let scores = { player: 0, enemy: 0 };
      let manaRegenInterval;
      const gameArea = document.getElementById('gameArea');
      const startBtn = document.getElementById('startGameBtn');

      function flashBackground(color) {
        const orig = document.body.style.backgroundColor;
        document.body.style.backgroundColor = color;
        setTimeout(() => document.body.style.backgroundColor = orig, 200);
      }

      function updateStats() {
        document.getElementById("playerHealth").innerText = playerHealth;
        document.getElementById("enemyHealth").innerText = enemyHealth;
        document.getElementById("playerMana").innerText = playerMana;
        document.getElementById("enemyMana").innerText = enemyMana;
      }

      function updateScoreboard() {
        document.getElementById("playerWins").innerText = scores.player;
        document.getElementById("enemyWins").innerText = scores.enemy;
      }

      function resetGame(fullReset=false) {
        playerHealth = enemyHealth = 100;
        playerMana = enemyMana = 30;
        playerDefending = enemyDefending = false;

        if (fullReset) { scores = { player:0, enemy:0 }; updateScoreboard(); }
        updateStats();

        if (manaRegenInterval) clearInterval(manaRegenInterval);
        manaRegenInterval = setInterval(() => {
          if(playerMana<30) playerMana++;
          if(enemyMana<30) enemyMana++;
          updateStats();
        }, 2000);
      }

      function playerAction(action) {
        playerDefending = false;
        if(action==="Attack"){ let dmg=Math.floor(Math.random()*10)+10; if(enemyDefending)dmg=Math.floor(dmg/2); enemyHealth-=dmg; alert(`You attacked for ${dmg}!`); flashBackground("red"); }
        else if(action==="Defend"){ playerDefending=true; alert("You defend this turn."); flashBackground("blue"); }
        else if(action==="Special" && playerMana>=20){ let dmg=Math.floor(Math.random()*15)+25; if(enemyDefending)dmg=Math.floor(dmg/2); enemyHealth-=dmg; playerMana-=20; alert(`Special Attack! Enemy -${dmg}`); flashBackground("purple"); }
        else if(action==="Heal" && playerMana>=10){ playerHealth=Math.min(playerHealth+30,100); playerMana-=10; alert("Healed +30 HP"); flashBackground("green"); }
        else{ alert("Not enough mana!"); }

        updateStats();
        if(enemyHealth>0) setTimeout(enemyTurn, 800);
        checkGameOver();
      }

      function enemyTurn(){
        enemyDefending=false;
        let choice;
        if(enemyHealth<=50 && enemyMana>=10){ choice=Math.random()<0.6?"Heal":"Defend"; }
        else if(enemyMana>=20 && Math.random()<0.5){ choice="Special"; }
        else if(Math.random()<0.2){ choice="Defend"; }
        else{ choice="Attack"; }

        if(choice==="Attack"){ let dmg=Math.floor(Math.random()*10)+10; if(playerDefending)dmg=Math.floor(dmg/2); playerHealth-=dmg; alert(`Enemy attacks for ${dmg}!`); flashBackground("orange"); }
        else if(choice==="Defend"){ enemyDefending=true; alert("Enemy defends"); flashBackground("blue"); }
        else if(choice==="Special" && enemyMana>=20){ let dmg=Math.floor(Math.random()*15)+25; if(playerDefending)dmg=Math.floor(dmg/2); playerHealth-=dmg; enemyMana-=20; alert(`Enemy Special -${dmg}`); flashBackground("purple"); }
        else if(choice==="Heal" && enemyMana>=10){ enemyHealth=Math.min(enemyHealth+30,100); enemyMana-=10; alert("Enemy healed +30 HP"); flashBackground("green"); }

        updateStats();
        checkGameOver();
      }

      function checkGameOver(){
        if(playerHealth<=0){ alert("You Lose!"); scores.enemy++; updateScoreboard(); resetGame(); }
        else if(enemyHealth<=0){ alert("You Win!"); scores.player++; updateScoreboard(); resetGame(); }
      }

      // ----- Start Game Button -----
      startBtn.addEventListener('click', () => {
        if(!walletAddress){ alert("Connect Phantom Wallet first!"); return; }
        resetGame(true);
        gameArea.style.display = 'block';
        startBtn.style.display = 'none';
        alert("Game Started âš”");
      });

    }); // End DOM load
  </script>
</body>
</html>