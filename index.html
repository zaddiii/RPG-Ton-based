



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TON RPG Game with Wallet</title>
  <style>
    body {
      background-color: burlywood;
      font-family: "Times New Roman", serif;
      color: black;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    button {
      border: none;
      border-radius: 15px;
      padding: 8px 15px;
      margin: 5px;
      background-color: white;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
    #gameArea { 
      margin-top: 20px; 
      display: none; 
    }
  </style>
</head>
<body>
  <h1>TON RPG Game</h1>

  <div id="ton-connect"></div>
  <p>Wallet Address: <span id="walletAddress">not connected</span></p>

  <div id="gameArea">
    <p>Player Health: <span id="playerHealth">100</span></p>
    <p>Player Mana: <span id="playerMana">30</span></p>
    <p>Enemy Health: <span id="enemyHealth">100</span></p>
    <p>Enemy Mana: <span id="enemyMana">30</span></p>

    <button onclick="playerAction('Attack')">Attack</button>
    <button onclick="playerAction('Defend')">Defend</button>
    <button onclick="playerAction('Special')">Special (-20 MP)</button>
    <button onclick="playerAction('Heal')">Heal (+30 HP, -10 MP)</button>
    <button onclick="resetGame(true)">Reset Game</button>
  </div>

  <h2>Scoreboard</h2>
  <p>Player Wins: <span id="playerWins">0</span></p>
  <p>Enemy Wins: <span id="enemyWins">0</span></p>

  <button id="startGameBtn">Start Game</button>

  <!-- TonConnect UI Library -->
  <script src="https://unpkg.com/@tonconnect/ui@2.0.9/dist/tonconnect-ui.min.js"></script>

  <script>
    // ===== TON Wallet Connect =====
    const manifestUrl = 'https://zaddiii.github.io/RPG-Ton-based/tonconnect-manifest.json';
    const tonConnectUI = new TonConnectUI({
      manifestUrl,
      buttonRootId: 'ton-connect'
    });
    tonConnectUI.render();

    async function syncWallet() {
      const account = tonConnectUI.account;
      document.getElementById('walletAddress').innerText =
        (account && account.address) ? account.address : 'not connected';
    }
    setInterval(syncWallet, 1500);

    document.getElementById('startGameBtn').addEventListener('click', () => {
      const account = tonConnectUI.account;
      if (account && account.address) {
        document.getElementById('gameArea').style.display = 'block';
        document.getElementById('startGameBtn').style.display = 'none';
        alert("Welcome to the Arena âš”!");
      } else {
        alert("Connect your TON Wallet first!");
      }
    });

    // ===== RPG Game Logic =====
    let playerHealth = 100, enemyHealth = 100;
    let playerMana = 30, enemyMana = 30;
    let playerDefending = false, enemyDefending = false;
    let scores = { player: 0, enemy: 0 };
    let manaRegenInterval;

    function flashBackground(color) {
      const orig = document.body.style.backgroundColor;
      document.body.style.backgroundColor = color;
      setTimeout(() => document.body.style.backgroundColor = orig, 200);
    }

    function updateStats() {
      document.getElementById("playerHealth").innerText = playerHealth;
      document.getElementById("enemyHealth").innerText = enemyHealth;
      document.getElementById("playerMana").innerText = playerMana;
      document.getElementById("enemyMana").innerText = enemyMana;
    }

    function updateScoreboard() {
      document.getElementById("playerWins").innerText = scores.player;
      document.getElementById("enemyWins").innerText = scores.enemy;
    }

    function resetGame(full=false) {
      playerHealth = enemyHealth = 100;
      playerMana = enemyMana = 30;
      playerDefending = enemyDefending = false;

      if (full) {
        scores = { player: 0, enemy: 0 };
        updateScoreboard();
      }

      updateStats();

      if (manaRegenInterval) clearInterval(manaRegenInterval);
      manaRegenInterval = setInterval(() => {
        if(playerMana < 30) playerMana++;
        if(enemyMana < 30) enemyMana++;
        updateStats();
      }, 2000);
    }

    function playerAction(action) {
      playerDefending = false;

      if (action === "Attack") {
        let dmg = Math.floor(Math.random() * 10) + 10;
        if (enemyDefending) dmg = Math.floor(dmg / 2);
        enemyHealth -= dmg;
        alert(`You attacked for ${dmg}!`);
        flashBackground("red");

      } else if (action === "Defend") {
        playerDefending = true;
        alert("You defend this turn.");
        flashBackground("blue");

      } else if (action === "Special" && playerMana >= 20) {
        let dmg = Math.floor(Math.random() * 15) + 25;
        if (enemyDefending) dmg = Math.floor(dmg / 2);
        enemyHealth -= dmg;
        playerMana -= 20;
        alert(`You used a Special Attack! Enemy takes ${dmg} damage!`);
        flashBackground("purple");

      } else if (action === "Heal" && playerMana >= 10) {
        playerHealth = Math.min(playerHealth + 30, 100);
        playerMana -= 10;
        alert("You healed for 30 HP!");
        flashBackground("green");

      } else {
        alert("Not enough mana!");
      }

      updateStats();
      if (enemyHealth > 0) setTimeout(enemyTurn, 800);
      checkGameOver();
    }

    function enemyTurn() {
      enemyDefending = false;
      let choice;

      if (enemyHealth <= 50 && enemyMana >= 10) {
        choice = Math.random() < 0.6 ? "Heal" : "Defend";
      } else if (enemyMana >= 20 && Math.random() < 0.5) {
        choice = "Special";
      } else if (Math.random() < 0.2) {
        choice = "Defend";
      } else {
        choice = "Attack";
      }

      if (choice === "Attack") {
        let dmg = Math.floor(Math.random() * 10) + 10;
        if (playerDefending) dmg = Math.floor(dmg / 2);
        playerHealth -= dmg;
        alert(`Enemy attacks you for ${dmg}!`);
        flashBackground("orange");

      } else if (choice === "Defend") {
        enemyDefending = true;
        alert("Enemy defends this turn.");
        flashBackground("blue");

      } else if (choice === "Special" && enemyMana >= 20) {
        let dmg = Math.floor(Math.random() * 15) + 25;
        if (playerDefending) dmg = Math.floor(dmg / 2);
        playerHealth -= dmg;
        enemyMana -= 20;
        alert(`Enemy uses Special Attack! You take ${dmg} damage!`);
        flashBackground("purple");

      } else if (choice === "Heal" && enemyMana >= 10) {
        enemyHealth = Math.min(enemyHealth + 30, 100);
        enemyMana -= 10;
        alert("Enemy heals for 30 HP!");
        flashBackground("green");
      }

      updateStats();
      checkGameOver();
    }

    function checkGameOver() {
      if (playerHealth <= 0) {
        alert("You Lose!");
        scores.enemy++;
        updateScoreboard();
        resetGame();
      } else if (enemyHealth <= 0) {
        alert("You Win!");
        scores.player++;
        updateScoreboard();
        resetGame();
      }
    }
  </script>
</body>
</html>