



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RPG Game | Solana</title>
  <script src="https://unpkg.com/@solana/web3.js@1.87.0/lib/index.iife.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      text-align: center;
      background: radial-gradient(circle at top, #101020, #050509);
      color: #fff;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    button {
      background: #14f195;
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      transition: 0.2s;
    }
    button:hover {
      background: #0ed684;
    }
    #game {
      margin-top: 20px;
      display: none;
      text-align: center;
    }
    #log {
      margin-top: 20px;
      font-size: 14px;
      color: #14f195;
      max-width: 320px;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h1>‚öîÔ∏è Solana RPG Battle ‚öîÔ∏è</h1>

  <button id="connectBtn">Connect Wallet</button>
  <div id="walletAddress"></div>

  <div id="game">
    <h2>Battle Arena</h2>
    <p>Your SOL Balance: <span id="balance">-</span></p>
    <button id="attackBtn">‚öîÔ∏è Attack</button>
    <button id="defendBtn">üõ°Ô∏è Defend</button>
    <p id="result"></p>
    <p id="log"></p>
  </div>

  <script>
    const connectBtn = document.getElementById('connectBtn');
    const walletAddress = document.getElementById('walletAddress');
    const gameSection = document.getElementById('game');
    const balanceField = document.getElementById('balance');
    const result = document.getElementById('result');
    const log = document.getElementById('log');

    const connection = new solanaWeb3.Connection(
      solanaWeb3.clusterApiUrl('devnet'),
      'confirmed'
    );

    let provider = null;
    let publicKey = null;

    // üü¢ Detect Phantom
    function getProvider() {
      if ('solana' in window) {
        const sol = window.solana;
        if (sol.isPhantom) return sol;
      }
      window.open('https://phantom.app/', '_blank');
    }

    // üîó Connect wallet
    connectBtn.onclick = async () => {
      provider = getProvider();
      if (!provider) {
        alert('Phantom not found!');
        return;
      }

      try {
        const res = await provider.connect();
        publicKey = res.publicKey.toString();
        walletAddress.textContent = `Connected: ${publicKey}`;
        connectBtn.style.display = 'none';
        gameSection.style.display = 'block';
        getBalance();
      } catch (err) {
        console.error(err);
        alert('Connection failed.');
      }
    };

    // üí∞ Get balance
    async function getBalance() {
      try {
        const balance = await connection.getBalance(
          new solanaWeb3.PublicKey(publicKey)
        );
        balanceField.textContent = (balance / solanaWeb3.LAMPORTS_PER_SOL).toFixed(3);
      } catch (err) {
        console.error(err);
        balanceField.textContent = 'Error';
      }
    }

    // ‚öîÔ∏è Game Logic
    document.getElementById('attackBtn').onclick = async () => {
      const outcome = Math.random() < 0.5 ? 'Victory!' : 'Defeat!';
      result.textContent = outcome;
      if (outcome === 'Victory!') await simulateReward();
      logMessage('Attack executed!');
    };

    document.getElementById('defendBtn').onclick = () => {
      const defense = Math.random() < 0.7 ? 'Successful Block!' : 'Failed Defense!';
      result.textContent = defense;
      logMessage('Defense move made!');
    };

    // üíé Simulate reward transaction (fake)
    async function simulateReward() {
      try {
        const tx = new solanaWeb3.Transaction().add(
          solanaWeb3.SystemProgram.transfer({
            fromPubkey: new solanaWeb3.PublicKey(publicKey),
            toPubkey: new solanaWeb3.PublicKey(publicKey),
            lamports: 0, // fake transaction
          })
        );
        logMessage('Reward simulated (no actual SOL sent).');
      } catch (err) {
        console.error(err);
        logMessage('Reward failed.');
      }
    }

    function logMessage(msg) {
      log.textContent = msg;
    }
  </script>
</body>
</html>