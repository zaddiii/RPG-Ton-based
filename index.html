



<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RPG TON Battle Arena — Claim Reward</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f6ecd7;
      color: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 36px;
    }
    #connectRoot { margin-bottom: 10px; }
    button {
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      background: #0b67ff;
      color: #fff;
      cursor: pointer;
      margin: 8px;
    }
    #messages { margin-top: 12px; min-height: 20px; font-weight: 600; color: #333; }
    #wallet { word-break: break-all; color: #0b67ff; }
  </style>
</head>
<body>
  <h1>RPG TON Battle Arena</h1>

  <div id="connectRoot"></div>
  <div>Connected wallet: <span id="wallet">not connected</span></div>
  <div id="messages"></div>

  <div style="margin-top:18px;">
    <button id="claimBtn" disabled>Claim 50 RPG (DevNet)</button>
  </div>

<script type="module">
(async () => {

  // ✅ BACKEND URL – Updated to your real deployed endpoint
  const BACKEND_REWARD_URL = "https://ton-reward-server.vercel.app/api/reward-api";
  const REWARD_AMOUNT = 50; // tokens to send

  // --- TonConnect UI Setup ---
  if (!window.TON_CONNECT_UI) {
    document.getElementById('messages').innerText = "TonConnect UI library failed to load — check your network.";
    return;
  }

  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: window.location.origin + "/tonconnect-manifest.json",
    buttonRootId: "connectRoot"
  });

  // Attempt to render wallet button
  try { tonConnectUI.render?.(); } catch (e) {}

  const walletSpan = document.getElementById("wallet");
  const messages = document.getElementById("messages");
  const claimBtn = document.getElementById("claimBtn");

  // Helper to safely get connected wallet address
  function getConnectedAddress() {
    try {
      if (tonConnectUI.account?.address) return tonConnectUI.account.address;
      if (tonConnectUI.connector?.account?.address) return tonConnectUI.connector.account.address;
      if (tonConnectUI.connectedWallet?.account?.address) return tonConnectUI.connectedWallet.account.address;
    } catch (e) {}
    return null;
  }

  // Poll connection status
  setInterval(() => {
    const address = getConnectedAddress();
    walletSpan.innerText = address || "not connected";
    claimBtn.disabled = !address;
  }, 800);

  // --- Claim Button Logic ---
  claimBtn.onclick = async () => {
    const address = getConnectedAddress();
    if (!address) {
      alert("Please connect your wallet first.");
      return;
    }

    if (!confirm(`You will receive ${REWARD_AMOUNT} RPG tokens to ${address} (DevNet). Proceed?`)) return;

    messages.innerText = "Requesting reward from server...";

    try {
      const res = await fetch(BACKEND_REWARD_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ to: address, amount: REWARD_AMOUNT })
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        messages.innerText = `Server error: ${res.status} ${res.statusText}`;
        alert("Reward failed — check Vercel logs for details.");
        return;
      }

      if (data.ok) {
        messages.innerText = `✅ Reward accepted — tx: ${data.tx}`;
        alert(`Success — reward request accepted!\nServer tx: ${data.tx}`);
      } else {
        messages.innerText = `❌ Server returned error: ${data.error || "unknown"}`;
        alert(`Server returned error: ${data.error || "unknown"}`);
      }

    } catch (err) {
      console.error(err);
      messages.innerText = "Network error — unable to reach reward server.";
      alert("Network error — check your connection or backend URL.");
    }
  };

})();
</script>
</body>
</html><!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RPG TON Battle Arena — Claim Reward</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f6ecd7;
      color: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 36px;
    }
    #connectRoot { margin-bottom: 10px; }
    button {
      padding: 10px 16px;
      border-radius: 10px;
      border: none;
      background: #0b67ff;
      color: #fff;
      cursor: pointer;
      margin: 8px;
    }
    #messages { margin-top: 12px; min-height: 20px; font-weight: 600; color: #333; }
    #wallet { word-break: break-all; color: #0b67ff; }
  </style>
</head>
<body>
  <h1>RPG TON Battle Arena</h1>

  <div id="connectRoot"></div>
  <div>Connected wallet: <span id="wallet">not connected</span></div>
  <div id="messages"></div>

  <div style="margin-top:18px;">
    <button id="claimBtn" disabled>Claim 50 RPG (DevNet)</button>
  </div>

<script type="module">
(async () => {

  // ✅ BACKEND URL – Updated to your real deployed endpoint
  const BACKEND_REWARD_URL = "https://ton-reward-server.vercel.app/api/reward-api";
  const REWARD_AMOUNT = 50; // tokens to send

  // --- TonConnect UI Setup ---
  if (!window.TON_CONNECT_UI) {
    document.getElementById('messages').innerText = "TonConnect UI library failed to load — check your network.";
    return;
  }

  const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: window.location.origin + "/tonconnect-manifest.json",
    buttonRootId: "connectRoot"
  });

  // Attempt to render wallet button
  try { tonConnectUI.render?.(); } catch (e) {}

  const walletSpan = document.getElementById("wallet");
  const messages = document.getElementById("messages");
  const claimBtn = document.getElementById("claimBtn");

  // Helper to safely get connected wallet address
  function getConnectedAddress() {
    try {
      if (tonConnectUI.account?.address) return tonConnectUI.account.address;
      if (tonConnectUI.connector?.account?.address) return tonConnectUI.connector.account.address;
      if (tonConnectUI.connectedWallet?.account?.address) return tonConnectUI.connectedWallet.account.address;
    } catch (e) {}
    return null;
  }

  // Poll connection status
  setInterval(() => {
    const address = getConnectedAddress();
    walletSpan.innerText = address || "not connected";
    claimBtn.disabled = !address;
  }, 800);

  // --- Claim Button Logic ---
  claimBtn.onclick = async () => {
    const address = getConnectedAddress();
    if (!address) {
      alert("Please connect your wallet first.");
      return;
    }

    if (!confirm(`You will receive ${REWARD_AMOUNT} RPG tokens to ${address} (DevNet). Proceed?`)) return;

    messages.innerText = "Requesting reward from server...";

    try {
      const res = await fetch(BACKEND_REWARD_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ to: address, amount: REWARD_AMOUNT })
      });

      const data = await res.json().catch(() => ({}));

      if (!res.ok) {
        messages.innerText = `Server error: ${res.status} ${res.statusText}`;
        alert("Reward failed — check Vercel logs for details.");
        return;
      }

      if (data.ok) {
        messages.innerText = `✅ Reward accepted — tx: ${data.tx}`;
        alert(`Success — reward request accepted!\nServer tx: ${data.tx}`);
      } else {
        messages.innerText = `❌ Server returned error: ${data.error || "unknown"}`;
        alert(`Server returned error: ${data.error || "unknown"}`);
      }

    } catch (err) {
      console.error(err);
      messages.innerText = "Network error — unable to reach reward server.";
      alert("Network error — check your connection or backend URL.");
    }
  };

})();
</script>
</body>
</html>