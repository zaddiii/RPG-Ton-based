



<!doctype html>
<html>
<head>
  <title>RPG √ó Solana NFT Boost</title>
  <style>
    body {
      background-color: burlywood;
      font-family: "Times New Roman", serif;
      text-align: center;
      color: black;
    }
    button {
      border: none;
      border-radius: 15px;
      padding: 8px 15px;
      margin: 5px;
      background-color: white;
      font-weight: bold;
      cursor: pointer;
    }
    #walletAddress {
      font-size: 14px;
      font-weight: bold;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>RPG √ó Solana ‚öîÔ∏è</h1>

  <!-- Wallet Connect -->
  <div id="walletConnect">
    <button id="connectWallet">üîó Connect Phantom Wallet</button>
    <p id="walletAddress"></p>
  </div>

  <!-- Game Area -->
  <div id="gameArea" style="display:none;">
    <p>Player Health: <span id="playerHealth">100</span></p>
    <p>Player Mana: <span id="playerMana">30</span></p>
    <p>Enemy Health: <span id="enemyHealth">100</span></p>
    <p>Enemy Mana: <span id="enemyMana">30</span></p>
    <button onclick="playerAction('Attack')">Attack</button>
    <button onclick="playerAction('Defend')">Defend</button>
    <button onclick="playerAction('Special')">Special (-20 MP)</button>
    <button onclick="playerAction('Heal')">Heal (+30 HP, -10 MP)</button>
    <button onclick="resetGame(true)">Reset Game</button>

    <h2>Scoreboard</h2>
    <p>Player Wins: <span id="playerWins">0</span></p>
    <p>Enemy Wins: <span id="enemyWins">0</span></p>
  </div>

  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
  <script>
    const { Connection, clusterApiUrl } = solanaWeb3;
    const connection = new Connection(clusterApiUrl("devnet"), "confirmed");
    let walletAddress = null;
    let nftPowerBoost = false;

    async function connectWallet() {
      if (window.solana && window.solana.isPhantom) {
        try {
          const response = await window.solana.connect();
          walletAddress = response.publicKey.toString();
          document.getElementById("walletAddress").innerText =
            "Connected: " + walletAddress.slice(0, 6) + "..." + walletAddress.slice(-4);

          alert("Wallet connected. Checking NFT ownership...");

          // ‚úÖ Check NFTs
          await checkNFTs(walletAddress);

          document.getElementById("walletConnect").style.display = "none";
          document.getElementById("gameArea").style.display = "block";
          resetGame(true);

          alert(nftPowerBoost
            ? "Arena Badge detected ‚Äî Power Boost Activated! ‚ö°"
            : "No Arena Badge NFT found ‚Äî Normal mode enabled.");

        } catch (err) {
          console.error("Wallet connection failed:", err);
        }
      } else {
        alert("Phantom Wallet not found. Install Phantom extension.");
      }
    }

    document.getElementById("connectWallet").addEventListener("click", connectWallet);

    // === NFT CHECK ===
    async function checkNFTs(address) {
      try {
        const url = `https://api-mainnet.magiceden.dev/v2/wallets/${address}/tokens?offset=0&limit=10`;
        const response = await fetch(url);
        const data = await response.json();

        // Check for "Arena Badge" or any NFT with matching name
        nftPowerBoost = data.some(
          nft =>
            nft?.collection?.toLowerCase()?.includes("arena") ||
            nft?.name?.toLowerCase()?.includes("badge")
        );
      } catch (error) {
        console.error("Error checking NFTs:", error);
        nftPowerBoost = false;
      }
    }

    // === GAME LOGIC ===
    let playerHealth, enemyHealth, playerMana, enemyMana;
    let scores = { player: 0, enemy: 0 };
    let playerDefending = false;
    let enemyDefending = false;
    let manaRegenInterval;

    function resetGame(fullReset = false) {
      playerHealth = nftPowerBoost ? 120 : 100;
      enemyHealth = 100;
      playerMana = 30;
      enemyMana = 30;
      playerDefending = false;
      enemyDefending = false;

      if (fullReset) scores = { player: 0, enemy: 0 };
      updateStats();

      if (manaRegenInterval) clearInterval(manaRegenInterval);
      manaRegenInterval = setInterval(() => {
        if (playerMana < 30) playerMana++;
        if (enemyMana < 30) enemyMana++;
        updateStats();
      }, 2000);
    }

    function updateStats() {
      document.getElementById("playerHealth").innerText = playerHealth;
      document.getElementById("enemyHealth").innerText = enemyHealth;
      document.getElementById("playerMana").innerText = playerMana;
      document.getElementById("enemyMana").innerText = enemyMana;
    }

    function updateScoreboard() {
      document.getElementById("playerWins").innerText = scores.player;
      document.getElementById("enemyWins").innerText = scores.enemy;
    }

    function playerAction(action) {
      playerDefending = false;
      let dmg;

      if (action === "Attack") {
        dmg = Math.floor(Math.random() * 10) + 10;
        if (enemyDefending) dmg = Math.floor(dmg / 2);
        if (nftPowerBoost) dmg = Math.floor(dmg * 1.2);
        enemyHealth -= dmg;
        alert(`You attacked for ${dmg}!`);
      } else if (action === "Defend") {
        playerDefending = true;
        alert("You defend this turn.");
      } else if (action === "Special" && playerMana >= 20) {
        dmg = Math.floor(Math.random() * 15) + 25;
        if (enemyDefending) dmg = Math.floor(dmg / 2);
        if (nftPowerBoost) dmg = Math.floor(dmg * 1.2);
        enemyHealth -= dmg;
        playerMana -= 20;
        alert(`You used Special! Enemy takes ${dmg} damage!`);
      } else if (action === "Heal" && playerMana >= 10) {
        let heal = nftPowerBoost ? 40 : 30;
        playerHealth = Math.min(playerHealth + heal, 120);
        playerMana -= 10;
        alert(`You healed +${heal} HP!`);
      } else {
        alert("Not enough mana!");
      }

      updateStats();
      checkGameOver();
      if (enemyHealth > 0) setTimeout(enemyTurn, 800);
    }

    function enemyTurn() {
      enemyDefending = false;
      let c;
      if (enemyHealth <= 50 && enemyMana >= 10) c = Math.random() < 0.6 ? "Heal" : "Defend";
      else if (enemyMana >= 20 && Math.random() < 0.5) c = "Special";
      else if (Math.random() < 0.2) c = "Defend";
      else c = "Attack";

      let dmg;

      if (c === "Attack") {
        dmg = Math.floor(Math.random() * 10) + 10;
        if (playerDefending) dmg = Math.floor(dmg / 2);
        playerHealth -= dmg;
        alert(`Enemy attacks for ${dmg}!`);
      } else if (c === "Defend") {
        enemyDefending = true;
        alert("Enemy defends.");
      } else if (c === "Special" && enemyMana >= 20) {
        dmg = Math.floor(Math.random() * 15) + 25;
        if (playerDefending) dmg = Math.floor(dmg / 2);
        playerHealth -= dmg;
        enemyMana -= 20;
        alert(`Enemy Special ‚Üí ${dmg} damage!`);
      } else if (c === "Heal" && enemyMana >= 10) {
        enemyHealth = Math.min(enemyHealth + 30, 100);
        enemyMana -= 10;
        alert("Enemy heals +30 HP!");
      }

      updateStats();
      checkGameOver();
    }

    function checkGameOver() {
      if (playerHealth <= 0) {
        alert("You Lose!");
        scores.enemy++;
        updateScoreboard();
        resetGame();
      } else if (enemyHealth <= 0) {
        alert("You Win!");
        scores.player++;
        updateScoreboard();
        resetGame();
      }
    }
  </script>
</body>
</html>